<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IO Models | Apuntes</title>
    <meta name="description" content="Scott Lin&#39;s notes">
    <link rel="icon" href="/favicon.ico">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    
    <link rel="preload" href="/assets/css/0.styles.5bfd9109.css" as="style"><link rel="preload" href="/assets/js/app.41d1b430.js" as="script"><link rel="preload" href="/assets/js/2.93c13480.js" as="script"><link rel="preload" href="/assets/js/8.ae1ddb50.js" as="script"><link rel="prefetch" href="/assets/js/10.8a9b6537.js"><link rel="prefetch" href="/assets/js/11.3f2c6e7a.js"><link rel="prefetch" href="/assets/js/12.280a4e99.js"><link rel="prefetch" href="/assets/js/13.5b58545b.js"><link rel="prefetch" href="/assets/js/3.7db57c28.js"><link rel="prefetch" href="/assets/js/4.13646481.js"><link rel="prefetch" href="/assets/js/5.b7ad6481.js"><link rel="prefetch" href="/assets/js/6.44ceb670.js"><link rel="prefetch" href="/assets/js/7.c64bda86.js"><link rel="prefetch" href="/assets/js/9.d2f8097b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5bfd9109.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apuntes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="content default"><h1 id="io-models"><a href="#io-models" aria-hidden="true" class="header-anchor">#</a> IO Models</h1> <h5 id="date-2019-04-07"><a href="#date-2019-04-07" aria-hidden="true" class="header-anchor">#</a> Date: 2019/04/07</h5> <br> <hr> <h2 id="_60-seconds"><a href="#_60-seconds" aria-hidden="true" class="header-anchor">#</a> 60 seconds</h2> <h3 id="operating-system-concepts"><a href="#operating-system-concepts" aria-hidden="true" class="header-anchor">#</a> Operating System Concepts</h3> <br> <p><img src="/images/2019/april/3e9d19e1edb50b83f1c5ff8fffab1113cadaea87c7dd657b3522d0af6cbe4ee7.png" alt="Operating System Concepts 10e - 3.6.2 Synchronization" title="Operating System Concepts 10e - 3.6.2 Synchronization"></p> <br> <h2 id="_60-minutes"><a href="#_60-minutes" aria-hidden="true" class="header-anchor">#</a> 60 minutes</h2> <h3 id="unix-networking-i-o-models"><a href="#unix-networking-i-o-models" aria-hidden="true" class="header-anchor">#</a> UNIX networking I/O models</h3> <p>首先來看一下UNIX這本書上對I/O模型的介紹:</p> <blockquote><p>There are normally two distinct phases for<br>
an input operation:</p> <ol><li><p>Waiting for the data to be ready</p></li> <li><p>Copying the data from the kernel to the process</p></li></ol></blockquote> <p>IO發生時通常會有兩個階段, <strong>等待資料準備好</strong> 及 <strong>將資料從 <abbr title="Kernel">核心</abbr> 中複製到 <abbr title="Process">行程</abbr> 中</strong>.</p> <p>以socket上的IO來說, 第一步是等待資料抵達; 當封包抵達以後, 把它複製到 <abbr title="Kernel">核心</abbr> 裡的緩衝區(kernel buffer).<br>
第二步才是再把資料從核心緩衝區複製到應用程式的緩衝區裡.</p> <p>因為這兩階段中的不同情況, 於是有了下列的5種I/O模型:</p> <br> <ul><li>Blocking I/O 阻塞式IO</li></ul> <p><img src="/images/2019/april/2d17e41441c8e68ca4a6821001854913e331c54133df21edd496523c6075cd27.png" alt="blocking" title="Blocking I/O model"></p> <p>書上有特別提到使用UDP當作範例的原因:</p> <blockquote><p>We use UDP for this example instead of TCP because with UDP,</p> <p>the concept of data being<br>
&quot;ready&quot; to read is simple: either an entire datagram has been received or it has not. With<br>
TCP it gets more complicated, as additional variables such as the socket's low-water mark<br>
come into play.</p></blockquote> <p>相較於TCP, UDP在 <strong>資料準備好被讀取</strong>的概念比較簡單, 只要考慮資料接受與否即可;<br>
TCP比較複雜, 還會牽扯到一些額外的變數等等.</p> <p>在表中,可以看到這個行程呼叫了 <strong>recvfrom</strong> 並執行了系統呼叫 ;<br>
可是一直到資料傳送跟複製資料到緩衝區的動作完成之前, 或是錯誤發生, <abbr title="Kernel">內核</abbr> 才會回傳結果,<br>
這個行程才會解除阻塞狀態, 繼續運行下去.</p> <blockquote><p>We say that our process is blocked the entire time from when it calls recvfrom until it<br>
returns.</p> <p>When recvfrom returns successfully, our application processes the datagram.</p></blockquote> <p>整個 <abbr title="Process">行程</abbr> 在 <strong>recvfrom</strong>回傳成功之前都是阻塞的狀態, 只有<strong>recvfrom</strong>回傳成功, 應用程式才會繼續處理資料.</p> <br> <ul><li>Nonblocking I/O 非阻塞IO</li></ul> <p><img src="/images/2019/april/64f94a916b338d380d953ee7f144a1694252abe87e3e62b07e14301cd1e7825d.png" alt="non-blocking"></p> <blockquote><p>When we set a socket to be nonblocking, we are telling the kernel &quot;when an I/O operation<br>
that I request cannot be completed without putting the process to <abbr title="使process/thread暫停一段時間">sleep</abbr>, do not put the<br>
process to <abbr title="使process/thread暫停一段時間">sleep</abbr>, but return an error instead.&quot;</p></blockquote> <p>當socket被設為非阻塞IO時, 其實就是告訴內核&quot;當一個IO請求在不讓行程 <strong><abbr title="使process/thread暫停一段時間">sleep</abbr></strong> 的情況下便無法完成時, 以回傳錯誤代替讓行程睡眠&quot;.</p> <p>如上圖所示, 可以看到前三次呼叫<strong>recvfrom</strong>時, 資料都還沒準備好, 內核這時候會馬上回傳 <strong>EWOULDBLOCK</strong>.</p> <br> <p>✍️ Linux手冊上對EWOULDBLOCK的說明:</p> <table><thead><tr><th>Error name</th> <th>Meaning</th></tr></thead> <tbody><tr><td>EAGAIN</td> <td>Resource temporarily unavailable (may be the same value as EWOULDBLOCK)</td></tr> <tr><td>EWOULDBLOCK</td> <td>Operation would block (may be same value as EAGAIN)</td></tr></tbody></table> <br> <p>第4次呼叫<strong>recvfrom</strong>時, 資料準備好了並複製到應用程式緩衝區中, 此時<strong>recvfrom</strong>回傳成功, 程式開始處理回傳的資料.<br>
像這種程式一直在迴圈當中等待呼叫成功就叫做 <strong>polling</strong>; 它會不斷地去詢問核心資料好了沒, 極為耗費CPU時間.</p> <ul><li>I/O multiplexing (select and poll)</li></ul> <p><img src="/images/2019/april/a524eac80b80ffc018295d5d0a635068bd7fae111c6e7f0c1f0006f50f4205cd.png" alt="I/O multiplexing (select and poll)" title="I/O multiplexing"></p> <ul><li>Signal-Driven I/O (SIGIO)</li></ul> <p><img src="/images/2019/april/0476506e7b93e82d3f6c05f13ecab2d174ab6c33234d9b35c477b0b16a1c92dc.png" alt="Signal driven I/O" title="Signal driven I/O"></p> <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p> <ul><li>Asynchronous I/O (the POSIX aio_functions)</li></ul> <p><img src="/images/2019/april/9a725fe7d43dfdeda3e49c72a9d28332624c9ef43cf7c85dea3a0c871b66f8d4.png" alt="Asynchronous I/O" title="Asynchronous I/O"></p> <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p> <p>一次5種IO模型的比較</p> <p><img src="/images/2019/april/1a308013c3e7b257a863e230ca51b8adc49bda8ef6360181bf97943de914961b.png" alt="comparison" title="Comparison"></p> <br> <hr> <h2 id="references"><a href="#references" aria-hidden="true" class="header-anchor">#</a> References</h2> <p>[ref#man-ERRNO(3)]:  &quot;Linux Programmer's Manual - ERRNO(3) / EWOULDBLOCK&quot;</p> <br> <h4 id="其他參考資料"><a href="#其他參考資料" aria-hidden="true" class="header-anchor">#</a> 其他參考資料</h4> <p>Carl. (2018, Jan 31). <a href="https://medium.com/@clu1022/%E6%B7%BA%E8%AB%87i-o-model-32da09c619e6" target="_blank" rel="noopener noreferrer">淺談I/O Model<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Medium.</p> <p>xianyunyh. (2018, Dec 29). <a href="https://github.com/xianyunyh/PHP-Interview/blob/master/Linux/LinuxIO%E6%A8%A1%E5%9E%8B.md" target="_blank" rel="noopener noreferrer">PHP-Interview - LinuxIO模型.md<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. xianyunyh/PHP-Interview.</p> <p>calidion. (2016, Jul 8). <a href="https://github.com/calidion/calidion.github.io/issues/40" target="_blank" rel="noopener noreferrer">同步，异步，阻塞，非阻塞等关系轻松理解 #40<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. calidion/calidion.github.io.</p> <p>Stevens, R &amp; Fenner, B &amp; Rudoff, A (2003, Nov 21). <a href="https://www.amazon.com/Unix-Network-Programming-Sockets-Networking/dp/0131411551" target="_blank" rel="noopener noreferrer">UNIX Network Programming Volume 1, Third Edition: The Sockets Networking API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Amazon.</p> <p>Silberschatz, A &amp; Galvin, P (2018, May 2). <a href="https://www.amazon.com/Operating-System-Concepts-Abridged-Companion/dp/1119456339/ref=sr_1_fkmrnull_1?keywords=Operating+System+Concepts+10e&amp;qid=1554626354&amp;s=books&amp;sr=1-1-fkmrnull" target="_blank" rel="noopener noreferrer">Operating System Concepts 10e<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Amazon.</p> <p>Linux Programmer's Manual (2017, Sep 15). <a href="http://man7.org/linux/man-pages/man3/sleep.3.html" target="_blank" rel="noopener noreferrer">SLEEP(3)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Linux Programmer's Manual.</p> <p>Linux Programmer's Manual (2017, Mar 06). <a href="http://man7.org/linux/man-pages/man3/errno.3.html" target="_blank" rel="noopener noreferrer">ERRNO(3)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Linux Programmer's Manual.</p> <p>[Title](href link)</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/7/2019, 3:51:56 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.41d1b430.js" defer></script><script src="/assets/js/2.93c13480.js" defer></script><script src="/assets/js/8.ae1ddb50.js" defer></script>
  </body>
</html>
