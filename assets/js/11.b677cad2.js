(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{375:function(t,a,s){"use strict";s.r(a);var r=s(27),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"float-precision"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#float-precision"}},[t._v("#")]),t._v(" Float Precision")]),t._v(" "),s("h5",{attrs:{id:"date-2019-april-15"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#date-2019-april-15"}},[t._v("#")]),t._v(" Date: 2019/April/15")]),t._v(" "),s("br"),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_60-seconds"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_60-seconds"}},[t._v("#")]),t._v(" 60 seconds")]),t._v(" "),s("h3",{attrs:{id:"問題-0-1-0-2-0-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#問題-0-1-0-2-0-3"}},[t._v("#")]),t._v(" 問題: 0.1 + 0.2 != 0.3 ?")]),t._v(" "),s("p",[t._v("由於計算機底層使用0與1來代表數字的緣故, 你看見的0.1跟0.2並不是真正的0.1+0.2."),s("br"),t._v("\n讓電腦實際上去跑一次就知道了:")]),t._v(" "),s("div",{staticClass:"language-php line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$b")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("var_dump")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("number_format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("' '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("var_dump")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("number_format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("' '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("var_dump")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("實際輸出:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('string(22) "0.30000000000000004441"\nstring(22) "0.29999999999999998890"\nbool(false)\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h3",{attrs:{id:"解決方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解決方案"}},[t._v("#")]),t._v(" 解決方案")]),t._v(" "),s("p",[t._v("THE FLOATING-POINT GUIDE在"),s("a",{attrs:{href:"https://floating-point-gui.de/languages/php/",title:"Floating-point cheat sheet for PHP",target:"_blank",rel:"noopener noreferrer"}},[t._v("php cheat sheet"),s("OutboundLink")],1),t._v("提到了可以使用 "),s("strong",[t._v("bcadd()來做運算")]),t._v(","),s("br"),t._v("\n也可以使用 "),s("strong",[t._v("number_format()")]),t._v(" 來印出資料.")]),t._v(" "),s("br"),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_60-minutes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_60-minutes"}},[t._v("#")]),t._v(" 60 minutes")]),t._v(" "),s("h3",{attrs:{id:"為什麼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#為什麼"}},[t._v("#")]),t._v(" 為什麼?")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://floating-point-gui.de/formats/binary/",title:"Binary Fractions",target:"_blank",rel:"noopener noreferrer"}},[t._v("THE FLOATING-POINT GUIDE - Binary Fractions"),s("OutboundLink")],1),t._v("有一個非常精美的表格,"),s("br"),t._v("\n解釋了表面上看到的數字, 實際上在電腦裡是怎麼儲存的:")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/2019/april/9e9c1a4f8b52babdff7655d5e7e7488b7c44303109044e37586faf1e5dfd15c1.png",alt:"Binary Fractions - How they work",title:"Binary Fractions - How they work"}})]),t._v(" "),s("p",[t._v("能用二進制表示的不是問題, 可是小數通常都不會是只靠二進制就能解決的.")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/2019/april/e66e6655d1ea94181657f3f010605a4ac2d7db29a58c1847889b67d18f025472.png",alt:"Binary Fractions - Problems",title:"Binary Fractions - Problems"}})]),t._v(" "),s("p",[t._v("如圖所示, 可以看到從十進位轉換成二進位時的誤差有多嚴重.")]),t._v(" "),s("p",[t._v("作者提到有三種方式可以解決這種問題:")]),t._v(" "),s("ol",[s("li",[t._v("Limited-Precision Decimal")])]),t._v(" "),s("blockquote",[s("p",[t._v("以PHP來說, 有善心人士寫成的"),s("a",{attrs:{href:"https://github.com/php-decimal/ext-decimal",title:"php-decimal/ext-decimal",target:"_blank",rel:"noopener noreferrer"}},[t._v("ext-decimal"),s("OutboundLink")],1),t._v(", 可以嘗試使用看看.")])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Arbitrary-Precision Decimal")])]),t._v(" "),s("blockquote",[s("p",[t._v("在PHP裡面就有BCMath與GMP兩種選擇了. 詳細的比較可以參考這則"),s("a",{attrs:{href:"https://stackoverflow.com/questions/6961685/arbitrary-precision-math-in-php",title:"Arbitrary-Precision Math in PHP",target:"_blank",rel:"noopener noreferrer"}},[t._v("StackOverflow"),s("OutboundLink")],1),t._v(".")])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("Symbolic calculations")])]),t._v(" "),s("blockquote",[s("p",[t._v("使用符號來表示數據, 而不是算出數字. 一樣有善心人士提供了"),s("a",{attrs:{href:"https://github.com/markrogoyski/math-php",title:"markrogoyski/math-php",target:"_blank",rel:"noopener noreferrer"}},[t._v("套件"),s("OutboundLink")],1),t._v("使用,"),s("br"),t._v("\n而且還是composer, 最低需求只需要"),s("strong",[t._v("PHP 7")]),t._v("!")])]),t._v(" "),s("br"),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),s("br"),t._v(" "),s("h4",{attrs:{id:"其他參考資料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他參考資料"}},[t._v("#")]),t._v(" 其他參考資料")]),t._v(" "),s("p",[t._v("PHP Manual (2019). "),s("a",{attrs:{href:"https://www.php.net/manual/en/language.types.float.php",target:"_blank",rel:"noopener noreferrer"}},[t._v("Floating point numbers"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("PHP Manual (2019). "),s("a",{attrs:{href:"https://www.php.net/manual/en/ref.bc.php",target:"_blank",rel:"noopener noreferrer"}},[t._v("BC Math Functions"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("PHP Manual (2019). "),s("a",{attrs:{href:"https://www.php.net/number-format",target:"_blank",rel:"noopener noreferrer"}},[t._v("number_format — Format a number with grouped thousands"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("Borgwardt, M. (a.k.a. brazzy) (2010). "),s("a",{attrs:{href:"https://floating-point-gui.de/basic/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Basic Answers"),s("OutboundLink")],1),t._v(". THE FLOATING-POINT GUIDE.")])])}),[],!1,null,null,null);a.default=e.exports}}]);